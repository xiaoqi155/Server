-- 挽UI库 - 完全独立版本
local WanUILibrary = {}

function WanUILibrary:CreateWindow(name)
    local library = {}
    library.name = name
    library.tabs = {}
    library.currentTab = nil
    
    -- 创建主UI
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WanUI"
    ScreenGui.Parent = game.CoreGui
    
    -- 悬浮按钮
    local FloatButton = Instance.new("ImageButton")
    FloatButton.Name = "FloatButton"
    FloatButton.Size = UDim2.new(0, 60, 0, 60)
    FloatButton.Position = UDim2.new(0, 20, 0.5, -30)
    FloatButton.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    FloatButton.Image = "rbxassetid://137429702672770"
    FloatButton.Parent = ScreenGui
    
    local FloatCorner = Instance.new("UICorner")
    FloatCorner.CornerRadius = UDim.new(0, 15)
    FloatCorner.Parent = FloatButton
    
    -- 主窗口
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 500, 0, 450)
    MainFrame.Position = UDim2.new(0.5, -250, 0.5, -225)
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    MainFrame.Visible = false
    MainFrame.Parent = ScreenGui
    
    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 12)
    MainCorner.Parent = MainFrame
    
    -- 背景图片
    local Background = Instance.new("ImageLabel")
    Background.Name = "Background"
    Background.Size = UDim2.new(1, 0, 1, 0)
    Background.BackgroundTransparency = 1
    Background.Image = "rbxassetid://137429702672770"
    Background.ImageTransparency = 0.9
    Background.ScaleType = Enum.ScaleType.Crop
    Background.Parent = MainFrame
    
    -- 标题栏
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 40)
    TitleBar.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    TitleBar.BackgroundTransparency = 0.3
    TitleBar.Parent = MainFrame
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -100, 1, 0)
    TitleLabel.Position = UDim2.new(0, 50, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = name
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.TextSize = 18
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = TitleBar
    
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 80, 0, 25)
    CloseButton.Position = UDim2.new(1, -85, 0, 8)
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    CloseButton.Text = "关闭"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.TextSize = 14
    CloseButton.Font = Enum.Font.Gotham
    CloseButton.Parent = TitleBar
    
    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 6)
    CloseCorner.Parent = CloseButton
    
    -- 标签页区域
    local TabContainer = Instance.new("Frame")
    TabContainer.Name = "TabContainer"
    TabContainer.Size = UDim2.new(0, 120, 1, -50)
    TabContainer.Position = UDim2.new(0, 0, 0, 40)
    TabContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    TabContainer.BackgroundTransparency = 0.3
    TabContainer.Parent = MainFrame
    
    local TabListLayout = Instance.new("UIListLayout")
    TabListLayout.Parent = TabContainer
    TabListLayout.Padding = UDim.new(0, 5)
    
    -- 内容区域
    local ContentFrame = Instance.new("Frame")
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Size = UDim2.new(1, -120, 1, -50)
    ContentFrame.Position = UDim2.new(0, 120, 0, 40)
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.Parent = MainFrame
    
    local ContentScrolling = Instance.new("ScrollingFrame")
    ContentScrolling.Size = UDim2.new(1, -20, 1, -20)
    ContentScrolling.Position = UDim2.new(0, 10, 0, 10)
    ContentScrolling.BackgroundTransparency = 1
    ContentScrolling.ScrollBarThickness = 4
    ContentScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ContentScrolling.Parent = ContentFrame
    
    local ContentLayout = Instance.new("UIListLayout")
    ContentLayout.Parent = ContentScrolling
    ContentLayout.Padding = UDim.new(0, 10)
    
    -- 交互功能
    FloatButton.MouseButton1Click:Connect(function()
        MainFrame.Visible = not MainFrame.Visible
    end)
    
    CloseButton.MouseButton1Click:Connect(function()
        MainFrame.Visible = false
    end)
    
    -- 拖动功能
    local dragging = false
    local dragStart, startPos
    
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
        end
    end)
    
    TitleBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    
    -- 标签页功能
    function library:CreateTab(tabName)
        local tab = {}
        tab.name = tabName
        
        -- 标签按钮
        local TabButton = Instance.new("TextButton")
        TabButton.Name = tabName
        TabButton.Size = UDim2.new(1, -10, 0, 35)
        TabButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
        TabButton.Text = tabName
        TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        TabButton.TextSize = 14
        TabButton.Font = Enum.Font.Gotham
        TabButton.Parent = TabContainer
        
        local TabCorner = Instance.new("UICorner")
        TabCorner.CornerRadius = UDim.new(0, 6)
        TabCorner.Parent = TabButton
        
        -- 标签内容
        local TabContent = Instance.new("Frame")
        TabContent.Name = tabName
        TabContent.Size = UDim2.new(1, 0, 1, 0)
        TabContent.BackgroundTransparency = 1
        TabContent.Visible = false
        TabContent.Parent = ContentFrame
        
        local TabScrolling = Instance.new("ScrollingFrame")
        TabScrolling.Size = UDim2.new(1, 0, 1, 0)
        TabScrolling.BackgroundTransparency = 1
        TabScrolling.ScrollBarThickness = 4
        TabScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
        TabScrolling.Parent = TabContent
        
        local TabLayout = Instance.new("UIListLayout")
        TabLayout.Parent = TabScrolling
        TabLayout.Padding = UDim.new(0, 10)
        
        -- 切换标签页
        TabButton.MouseButton1Click:Connect(function()
            if library.currentTab then
                library.currentTab.content.Visible = false
                library.currentTab.button.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
            end
            
            TabContent.Visible = true
            TabButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200) -- 蓝色高亮
            library.currentTab = {button = TabButton, content = TabContent}
        end)
        
        -- 功能区功能
        function tab:CreateSection(sectionName)
            local section = {}
            
            local SectionFrame = Instance.new("Frame")
            SectionFrame.Size = UDim2.new(1, -20, 0, 0)
            SectionFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
            SectionFrame.BackgroundTransparency = 0.5
            SectionFrame.Parent = TabScrolling
            
            local SectionCorner = Instance.new("UICorner")
            SectionCorner.CornerRadius = UDim.new(0, 8)
            SectionCorner.Parent = SectionFrame
            
            local SectionLabel = Instance.new("TextLabel")
            SectionLabel.Size = UDim2.new(1, -20, 0, 30)
            SectionLabel.Position = UDim2.new(0, 10, 0, 5)
            SectionLabel.BackgroundTransparency = 1
            SectionLabel.Text = sectionName
            SectionLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            SectionLabel.TextSize = 16
            SectionLabel.Font = Enum.Font.GothamBold
            SectionLabel.TextXAlignment = Enum.TextXAlignment.Left
            SectionLabel.Parent = SectionFrame
            
            local SectionContent = Instance.new("Frame")
            SectionContent.Size = UDim2.new(1, -20, 0, 0)
            SectionContent.Position = UDim2.new(0, 10, 0, 40)
            SectionContent.BackgroundTransparency = 1
            SectionContent.Parent = SectionFrame
            
            local SectionLayout = Instance.new("UIListLayout")
            SectionLayout.Parent = SectionContent
            SectionLayout.Padding = UDim.new(0, 8)
            
            -- 自动调整大小
            SectionLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                SectionContent.Size = UDim2.new(1, -20, 0, SectionLayout.AbsoluteContentSize.Y)
                SectionFrame.Size = UDim2.new(1, -20, 0, SectionLayout.AbsoluteContentSize.Y + 50)
            end)
            
            -- 按钮功能
            function section:CreateButton(buttonText, callback)
                local Button = Instance.new("TextButton")
                Button.Size = UDim2.new(1, 0, 0, 35)
                Button.BackgroundColor3 = Color3.fromRGB(65, 65, 75)
                Button.Text = buttonText
                Button.TextColor3 = Color3.fromRGB(255, 255, 255)
                Button.TextSize = 14
                Button.Font = Enum.Font.Gotham
                Button.Parent = SectionContent
                
                local ButtonCorner = Instance.new("UICorner")
                ButtonCorner.CornerRadius = UDim.new(0, 6)
                ButtonCorner.Parent = Button
                
                Button.MouseButton1Click:Connect(callback)
                
                return Button
            end
            
            -- 开关功能
            function section:CreateToggle(toggleText, defaultValue, callback)
                local ToggleFrame = Instance.new("Frame")
                ToggleFrame.Size = UDim2.new(1, 0, 0, 35)
                ToggleFrame.BackgroundColor3 = Color3.fromRGB(65, 65, 75)
                ToggleFrame.Parent = SectionContent
                
                local ToggleCorner = Instance.new("UICorner")
                ToggleCorner.CornerRadius = UDim.new(0, 6)
                ToggleCorner.Parent = ToggleFrame
                
                local ToggleLabel = Instance.new("TextLabel")
                ToggleLabel.Size = UDim2.new(0.7, 0, 1, 0)
                ToggleLabel.Position = UDim2.new(0, 10, 0, 0)
                ToggleLabel.BackgroundTransparency = 1
                ToggleLabel.Text = toggleText
                ToggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                ToggleLabel.TextSize = 14
                ToggleLabel.Font = Enum.Font.Gotham
                ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
                ToggleLabel.Parent = ToggleFrame
                
                local ToggleButton = Instance.new("TextButton")
                ToggleButton.Size = UDim2.new(0, 50, 0, 20)
                ToggleButton.Position = UDim2.new(1, -60, 0.5, -10)
                ToggleButton.BackgroundColor3 = defaultValue and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(100, 100, 110)
                ToggleButton.Text = defaultValue and "开" or "关"
                ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
                ToggleButton.TextSize = 12
                ToggleButton.Font = Enum.Font.Gotham
                ToggleButton.Parent = ToggleFrame
                
                local ToggleBtnCorner = Instance.new("UICorner")
                ToggleBtnCorner.CornerRadius = UDim.new(0, 6)
                ToggleBtnCorner.Parent = ToggleButton
                
                local state = defaultValue
                
                ToggleButton.MouseButton1Click:Connect(function()
                    state = not state
                    if state then
                        ToggleButton.Text = "开"
                        ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
                    else
                        ToggleButton.Text = "关"
                        ToggleButton.BackgroundColor3 = Color3.fromRGB(100, 100, 110)
                    end
                    callback(state)
                end)
                
                return ToggleFrame
            end
            
            -- 滑块功能
            function section:CreateSlider(sliderText, min, max, defaultValue, callback)
                local SliderFrame = Instance.new("Frame")
                SliderFrame.Size = UDim2.new(1, 0, 0, 50)
                SliderFrame.BackgroundColor3 = Color3.fromRGB(65, 65, 75)
                SliderFrame.Parent = SectionContent
                
                local SliderCorner = Instance.new("UICorner")
                SliderCorner.CornerRadius = UDim.new(0, 6)
                SliderCorner.Parent = SliderFrame
                
                local SliderLabel = Instance.new("TextLabel")
                SliderLabel.Size = UDim2.new(1, -20, 0, 20)
                SliderLabel.Position = UDim2.new(0, 10, 0, 5)
                SliderLabel.BackgroundTransparency = 1
                SliderLabel.Text = sliderText .. ": " .. defaultValue
                SliderLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                SliderLabel.TextSize = 14
                SliderLabel.Font = Enum.Font.Gotham
                SliderLabel.TextXAlignment = Enum.TextXAlignment.Left
                SliderLabel.Parent = SliderFrame
                
                local SliderBar = Instance.new("Frame")
                SliderBar.Size = UDim2.new(1, -20, 0, 8)
                SliderBar.Position = UDim2.new(0, 10, 0, 35)
                SliderBar.BackgroundColor3 = Color3.fromRGB(100, 100, 110)
                SliderBar.Parent = SliderFrame
                
                local SliderBarCorner = Instance.new("UICorner")
                SliderBarCorner.CornerRadius = UDim.new(0, 4)
                SliderBarCorner.Parent = SliderBar
                
                local SliderFill = Instance.new("Frame")
                SliderFill.Size = UDim2.new((defaultValue - min) / (max - min), 0, 1, 0)
                SliderFill.BackgroundColor3 = Color3.fromRGB(80, 120, 200) -- 蓝色
                SliderFill.Parent = SliderBar
                
                local SliderFillCorner = Instance.new("UICorner")
                SliderFillCorner.CornerRadius = UDim.new(0, 4)
                SliderFillCorner.Parent = SliderFill
                
                local dragging = false
                
                local function updateSlider(value)
                    value = math.clamp(value, min, max)
                    SliderFill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
                    SliderLabel.Text = sliderText .. ": " .. math.floor(value)
                    callback(value)
                end
                
                SliderBar.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = true
                    end
                end)
                
                SliderBar.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                
                game:GetService("UserInputService").InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        local relativeX = (input.Position.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X
                        local value = min + (max - min) * math.clamp(relativeX, 0, 1)
                        updateSlider(value)
                    end
                end)
                
                return SliderFrame
            end
            
            -- 标签功能
            function section:CreateLabel(labelText)
                local Label = Instance.new("TextLabel")
                Label.Size = UDim2.new(1, 0, 0, 25)
                Label.BackgroundTransparency = 1
                Label.Text = labelText
                Label.TextColor3 = Color3.fromRGB(200, 200, 200)
                Label.TextSize = 14
                Label.Font = Enum.Font.Gotham
                Label.TextXAlignment = Enum.TextXAlignment.Left
                Label.Parent = SectionContent
                
                return Label
            end
            
            return section
        end
        
        table.insert(library.tabs, tab)
        return tab
    end
    
    -- 默认打开第一个标签页
    spawn(function()
        wait(0.1)
        if TabContainer:FindFirstChildOfClass("TextButton") then
            TabContainer:FindFirstChildOfClass("TextButton"):MouseButton1Click()
        end
    end)
    
    return library
end

return WanUILibrary
